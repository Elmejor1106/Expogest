<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Material Comercial - ExpoGest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <div th:replace="~{fragments/navbar :: styles}"></div>
</head>
<body>

<nav th:replace="~{fragments/navbar :: navbar('Expositor', '/expositor/panelExpositor')}"></nav>

<div class="container mt-4 mb-5">
    <!-- Mensajes -->
    <div th:if="${mensaje}" th:class="'alert alert-' + ${tipo} + ' alert-dismissible fade show'" role="alert">
        <i th:class="${tipo == 'success' ? 'bi bi-check-circle-fill' : 'bi bi-exclamation-triangle-fill'} + ' me-2'"></i>
        <span th:text="${mensaje}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Header -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0"><i class="bi bi-shop-window me-2"></i>Mi Material Comercial</h2>
            <small>Sube información sobre tu empresa para que visitantes y evaluadores la vean</small>
        </div>
        
        <!-- Información del Stand Asignado -->
        <div th:if="${standActual != null && eventoActual != null}" class="card-body bg-light">
            <div class="alert alert-info mb-0">
                <h5 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Stand Asignado</h5>
                <hr>
                <p class="mb-1">
                    <strong>Evento:</strong> <span th:text="${eventoActual.nombre}"></span>
                </p>
                <p class="mb-1">
                    <strong>Stand:</strong> <span th:text="${standActual.numero}"></span> - 
                    <span th:text="${standActual.nombre}"></span>
                </p>
                <p class="mb-0">
                    <strong>Ubicación:</strong> <span th:text="${standActual.ubicacion}"></span>
                </p>
            </div>
        </div>
        
        <!-- Advertencia si no tiene stand asignado -->
        <div th:if="${solicitudesAprobadas == null || solicitudesAprobadas.isEmpty()}" class="card-body">
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong>No tienes un stand asignado.</strong>
                <p class="mb-0">
                    Debes solicitar y que te aprueben un stand para poder gestionar material comercial.
                    <a th:href="@{/expositor/solicitudes/nueva}" class="alert-link">Solicitar Stand</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Formulario -->
    <div class="card shadow-sm">
        <div class="card-body">
            <form th:action="@{/expositor/material-comercial/guardar}" method="post" th:object="${material}" enctype="multipart/form-data">
                <input type="hidden" th:field="*{id}">
                <input type="hidden" th:field="*{expositorId}">
                <input type="hidden" th:field="*{standId}">
                


                <!-- Descripción comercial -->
                <div class="mb-4">
                    <label for="descripcion" class="form-label">
                        <i class="bi bi-file-text me-1"></i>Descripción Comercial <span class="text-danger">*</span>
                    </label>
                    <textarea class="form-control" id="descripcion" th:field="*{descripcion}" 
                              rows="5" required
                              placeholder="Describe tu empresa, productos o servicios..."></textarea>
                    <small class="form-text text-muted">Máximo recomendado: 500 caracteres</small>
                </div>

                <!-- Logo - Subir archivo o URL -->
                <div class="mb-4">
                    <label class="form-label">
                        <i class="bi bi-image me-1"></i>Logotipo de la Empresa
                    </label>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="logoFile" class="form-label small">Subir archivo (PNG, JPG - Máx 5MB)</label>
                            <input type="file" class="form-control" id="logoFile" name="logoFile" 
                                   accept="image/png,image/jpeg,image/jpg">
                        </div>
                        <div class="col-md-6">
                            <label for="logoUrl" class="form-label small">O proporcionar URL</label>
                            <input type="url" class="form-control" id="logoUrl" th:field="*{logoUrl}" 
                                   placeholder="https://ejemplo.com/logo.png">
                        </div>
                    </div>
                    
                    <!-- Mostrar logo actual si existe -->
                    <div th:if="${material.logoPath != null || material.logoUrl != null}" class="mt-2">
                        <small class="text-muted">Logo actual:</small><br>
                        <img th:if="${material.logoPath != null}" 
                             th:src="@{'/uploads/' + ${material.logoPath}}" 
                             alt="Logo actual" class="img-thumbnail mt-1" style="max-height: 100px;">
                        <img th:if="${material.logoPath == null && material.logoUrl != null}" 
                             th:src="${material.logoUrl}" 
                             alt="Logo actual" class="img-thumbnail mt-1" style="max-height: 100px;">
                    </div>
                </div>

                <!-- Catálogos - Subir archivos o URLs -->
                <div class="mb-4">
                    <label class="form-label">
                        <i class="bi bi-file-earmark-pdf me-1"></i>Catálogos PDF
                    </label>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="catalogoFiles" class="form-label small">Subir archivos PDF (Máx 10MB c/u)</label>
                            <input type="file" class="form-control" id="catalogoFiles" name="catalogoFiles" 
                                   accept="application/pdf" multiple>
                            <small class="form-text text-muted">Puedes seleccionar múltiples archivos</small>
                        </div>
                        <div class="col-md-6">
                            <label for="catalogoUrls" class="form-label small">O proporcionar URLs (una por línea)</label>
                            <textarea class="form-control" id="catalogoUrls" 
                                      th:field="*{catalogoUrls}" 
                                      rows="3"
                                      placeholder="https://ejemplo.com/catalogo1.pdf&#10;https://ejemplo.com/catalogo2.pdf"></textarea>
                        </div>
                    </div>
                    
                    <!-- Mostrar catálogos actuales si existen -->
                    <div th:if="${material.catalogoPaths != null && !material.catalogoPaths.isEmpty()}" class="mt-2">
                        <small class="text-muted">Catálogos subidos:</small>
                        <ul class="list-unstyled">
                            <li th:each="path, stat : ${material.catalogoPaths}">
                                <a th:href="@{'/uploads/' + ${path}}" target="_blank" class="btn btn-sm btn-outline-danger mt-1">
                                    <i class="bi bi-file-pdf"></i> Catálogo [[${stat.index + 1}]]
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Multimedia - Subir archivos o URLs -->
                <div class="mb-4">
                    <label class="form-label">
                        <i class="bi bi-camera-video me-1"></i>Videos e Imágenes
                    </label>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="multimediaFiles" class="form-label small">Subir imágenes/videos (Máx 50MB c/u)</label>
                            <input type="file" class="form-control" id="multimediaFiles" name="multimediaFiles" 
                                   accept="image/*,video/*" multiple>
                            <small class="form-text text-muted">JPG, PNG, MP4, etc. Múltiples archivos permitidos</small>
                        </div>
                        <div class="col-md-6">
                            <label for="multimediaUrls" class="form-label small">O proporcionar URLs (una por línea)</label>
                            <textarea class="form-control" id="multimediaUrls" 
                                      th:field="*{multimediaUrls}" 
                                      rows="4"
                                      placeholder="https://youtube.com/watch?v=...&#10;https://ejemplo.com/imagen1.jpg"></textarea>
                        </div>
                    </div>
                    
                    <!-- Mostrar multimedia actual si existe -->
                    <div th:if="${material.multimediaPaths != null && !material.multimediaPaths.isEmpty()}" class="mt-2">
                        <small class="text-muted">Archivos multimedia subidos:</small>
                        <div class="row g-2 mt-1">
                            <div class="col-auto" th:each="path, stat : ${material.multimediaPaths}">
                                <a th:href="@{'/uploads/' + ${path}}" target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-play-circle"></i> Ver [[${stat.index + 1}]]
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="d-flex justify-content-between">
                    <a th:href="@{/expositor/panelExpositor}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Volver
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save me-2"></i>Guardar Material
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Preview Card (si existe material) -->
    <div th:if="${material.id != null}" class="card mt-4 shadow-sm">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-eye me-2"></i>Vista Previa de tu Material</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Logo -->
                <div class="col-md-3 text-center mb-3" th:if="${material.logoPath != null || (material.logoUrl != null && !material.logoUrl.isEmpty())}">
                    <h6>Logo:</h6>
                    <img th:if="${material.logoPath != null}" 
                         th:src="@{'/uploads/' + ${material.logoPath}}" 
                         alt="Logo" class="img-fluid rounded shadow-sm" style="max-height: 150px;">
                    <img th:if="${material.logoPath == null && material.logoUrl != null && !material.logoUrl.isEmpty()}" 
                         th:src="${material.logoUrl}" 
                         alt="Logo" class="img-fluid rounded shadow-sm" style="max-height: 150px;">
                </div>
                
                <!-- Descripción -->
                <div class="col-md-9">
                    <h5>Descripción:</h5>
                    <p th:text="${material.descripcion}" class="text-muted"></p>
                    
                    <!-- Catálogos subidos -->
                    <div th:if="${material.catalogoPaths != null && !material.catalogoPaths.isEmpty()}" class="mt-3">
                        <h6><i class="bi bi-file-earmark-pdf text-danger me-2"></i>Catálogos subidos:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <a th:each="path, stat : ${material.catalogoPaths}" 
                               th:href="@{'/uploads/' + ${path}}" 
                               target="_blank" 
                               class="btn btn-sm btn-danger">
                                <i class="bi bi-download me-1"></i> Catálogo [[${stat.index + 1}]]
                            </a>
                        </div>
                    </div>
                    
                    <!-- Catálogos por URL -->
                    <div th:if="${material.catalogoUrls != null && !material.catalogoUrls.isEmpty()}" class="mt-3">
                        <h6><i class="bi bi-link-45deg text-info me-2"></i>Catálogos (URL):</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <a th:each="url, stat : ${material.catalogoUrls}" 
                               th:href="${url}" 
                               target="_blank" 
                               class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-download me-1"></i> Catálogo [[${stat.index + 1}]]
                            </a>
                        </div>
                    </div>
                    
                    <!-- Multimedia subida -->
                    <div th:if="${material.multimediaPaths != null && !material.multimediaPaths.isEmpty()}" class="mt-3">
                        <h6><i class="bi bi-camera-video text-primary me-2"></i>Multimedia subida:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <a th:each="path, stat : ${material.multimediaPaths}" 
                               th:href="@{'/uploads/' + ${path}}" 
                               target="_blank" 
                               class="btn btn-sm btn-primary">
                                <i class="bi bi-play-circle me-1"></i> Ver [[${stat.index + 1}]]
                            </a>
                        </div>
                    </div>
                    
                    <!-- Multimedia por URL -->
                    <div th:if="${material.multimediaUrls != null && !material.multimediaUrls.isEmpty()}" class="mt-3">
                        <h6><i class="bi bi-link-45deg text-info me-2"></i>Multimedia (URL):</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <a th:each="url, stat : ${material.multimediaUrls}" 
                               th:href="${url}" 
                               target="_blank" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-play-circle me-1"></i> Ver [[${stat.index + 1}]]
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Convertir textarea de URLs a listas
document.querySelector('form').addEventListener('submit', function(e) {
    const catalogoTextarea = document.getElementById('catalogoUrls');
    const multimediaTextarea = document.getElementById('multimediaUrls');
    
    // Procesar catálogos
    if (catalogoTextarea.value) {
        const catalogos = catalogoTextarea.value.split('\n').filter(url => url.trim());
        catalogoTextarea.value = catalogos.join(',');
    }
    
    // Procesar multimedia
    if (multimediaTextarea.value) {
        const multimedia = multimediaTextarea.value.split('\n').filter(url => url.trim());
        multimediaTextarea.value = multimedia.join(',');
    }
});

// Al cargar, convertir de lista a textarea
window.addEventListener('DOMContentLoaded', function() {
    const catalogoTextarea = document.getElementById('catalogoUrls');
    const multimediaTextarea = document.getElementById('multimediaUrls');
    
    if (catalogoTextarea.value && catalogoTextarea.value.includes(',')) {
        catalogoTextarea.value = catalogoTextarea.value.split(',').join('\n');
    }
    
    if (multimediaTextarea.value && multimediaTextarea.value.includes(',')) {
        multimediaTextarea.value = multimediaTextarea.value.split(',').join('\n');
    }
});
</script>
</body>
</html>
